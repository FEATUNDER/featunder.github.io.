# –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
# –ü—Ä–µ–¥—Å—Ç–∞–≤—å—Ç–µ, —á—Ç–æ –º—ã –æ—Ç–∫—Ä—ã–≤–∞–µ–º —è—â–∏–∫ —Å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–º–∏ –∏ –¥–æ—Å—Ç–∞–µ–º –Ω—É–∂–Ω—ã–µ –≥–∞–µ—á–Ω—ã–µ –∫–ª—é—á–∏ –∏ –æ—Ç–≤–µ—Ä—Ç–∫–∏.
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup, WebAppInfo
from telegram.ext import Application, CommandHandler, CallbackQueryHandler, ContextTypes
import json  # –≠—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–æ–º–æ–∂–µ—Ç –Ω–∞–º —Ä–∞–±–æ—Ç–∞—Ç—å —Å –¥–∞–Ω–Ω—ã–º–∏ –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON (–∫–∞–∫ —Å —Ç–µ–∫—Å—Ç–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü–µ–π)

# –í—Å—Ç–∞–≤—å—Ç–µ —Å—é–¥–∞ –≤–∞—à –°–ï–ö–†–ï–¢–ù–´–ô –¢–û–ö–ï–ù –æ—Ç BotFather
BOT_TOKEN = "8450460586:AAFXV-qRVEm0-MYt93R9SZwjBPpCEtDv8N0"

# –§—É–Ω–∫—Ü–∏—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è. –û–Ω–∞ —Å—Ä–∞–±–æ—Ç–∞–µ—Ç, –∫–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–º–µ—Ç /start
async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—ä—è—Å–Ω–µ–Ω–∏–µ: –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–ø–µ—Ä–≤—ã–µ –ø–∏—à–µ—Ç /start, –±–æ—Ç –ø–æ–ª—É—á–∞–µ—Ç –æ–±—ä–µ–∫—Ç `update`.
       –ò–∑ –Ω–µ–≥–æ –º—ã –º–æ–∂–µ–º –≤–∑—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç."""

    # –°–æ–∑–¥–∞–µ–º –∫—Ä–∞—Å–∏–≤—É—é –∫–Ω–æ–ø–∫—É. –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ –Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä web_app=...
    # –í –Ω–µ–º –º—ã –≥–æ–≤–æ—Ä–∏–º: "–≠—Ç–∞ –∫–Ω–æ–ø–∫–∞ –¥–æ–ª–∂–Ω–∞ –æ—Ç–∫—Ä—ã—Ç—å –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ø–æ –∞–¥—Ä–µ—Å—É https://–≤–∞—à-—Å–∞–π—Ç.com"
    # –ü–æ–∫–∞ –º—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –∑–∞–≥–ª—É—à–∫—É. –ó–∞–º–µ–Ω–∏—Ç–µ –ø–æ–∑–∂–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å –≤–∞—à–µ–≥–æ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
    keyboard = [
        [InlineKeyboardButton("üõçÔ∏è –û—Ç–∫—Ä—ã—Ç—å –∫–∞—Ç–∞–ª–æ–≥", web_app=WebAppInfo(url="https://github.com/FEATUNDER/TG-BOT-CORE/blob/main/index.html"))]
    ]
    reply_markup = InlineKeyboardMarkup(keyboard)

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å –Ω–∞—à–µ–π –∫–Ω–æ–ø–∫–æ–π
    await update.message.reply_text(
        f"–ü—Ä–∏–≤–µ—Ç, {update.effective_user.first_name}! –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –Ω–∞—à –º–∞–≥–∞–∑–∏–Ω –æ–¥–µ–∂–¥—ã.\n"
        "–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ, —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã—Ç—å –∫–∞—Ç–∞–ª–æ–≥ –∏ –≤—ã–±—Ä–∞—Ç—å –ø–æ–Ω—Ä–∞–≤–∏–≤—à—É—é—Å—è –≤–µ—â—å.",
        reply_markup=reply_markup
    )

# –§—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è –±—É–¥–µ—Ç –ø—Ä–∏–Ω–∏–º–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
async def web_app_data(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—ä—è—Å–Ω–µ–Ω–∏–µ: –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω–∞–∂–º–µ—Ç "–û—Ç–ø—Ä–∞–≤–∏—Ç—å",
       –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏–¥—É—Ç —Å—é–¥–∞. –ú—ã –∏—Ö —Ä–∞—Å–ø–∞–∫—É–µ–º –∏ –æ—Ç–ø—Ä–∞–≤–∏–º –ø—Ä–æ–¥–∞–≤—Ü—É."""

    # –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ (–≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON-—Å—Ç—Ä–æ–∫–∏) –∏–∑ –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    data = json.loads(update.effective_message.web_app_data.data)
    # –¢–µ–ø–µ—Ä—å `data` - —ç—Ç–æ —Å–ª–æ–≤–∞—Ä—å Python, –Ω–∞–ø—Ä–∏–º–µ—Ä:
    # {'user_name': '–ê–Ω–Ω–∞', 'user_phone': '+79161234567', 'product': '–§—É—Ç–±–æ–ª–∫–∞ –æ–≤–µ—Ä—Å–∞–π–∑', 'size': 'M', 'price': 1500}

    # –§–æ—Ä–º–∏—Ä—É–µ–º –ø–æ–Ω—è—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø—Ä–æ–¥–∞–≤—Ü–∞
    message_for_seller = (
        "üéâ *–ù–æ–≤—ã–π –∑–∞–∫–∞–∑ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞!*\n"
        f"*–¢–æ–≤–∞—Ä:* {data['product']}\n"
        f"*–†–∞–∑–º–µ—Ä:* {data['size']}\n"
        f"*–¶–µ–Ω–∞:* {data['price']} —Ä—É–±.\n"
        f"*–ö–ª–∏–µ–Ω—Ç:* {data['user_name']}\n"
        f"*–¢–µ–ª–µ—Ñ–æ–Ω:* `{data['user_phone']}`\n"
        "\n–°–≤—è–∂–∏—Å—å —Å –∫–ª–∏–µ–Ω—Ç–æ–º –∫–∞–∫ –º–æ–∂–Ω–æ —Å–∫–æ—Ä–µ–µ!"
    )

    # –í–ê–ñ–ù–û: –ó–¥–µ—Å—å –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –í–ê–® –¢–ï–õ–ï–ì–†–ê–ú ID (–∫–∞–∫ —Ü–∏—Ñ—Ä—ã).
    # –ß—Ç–æ–±—ã –µ–≥–æ —É–∑–Ω–∞—Ç—å, –Ω–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É @userinfobot. –û–Ω –ø–æ–∫–∞–∂–µ—Ç –≤–∞—à `id`.
    seller_chat_id = "402403714"

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–æ–¥–∞–≤—Ü—É
    await context.bot.send_message(
        chat_id=seller_chat_id,
        text=message_for_seller,
        parse_mode='Markdown'  # –ß—Ç–æ–±—ã —Ç–µ–∫—Å—Ç –±—ã–ª –∂–∏—Ä–Ω—ã–º (*–∂–∏—Ä–Ω—ã–π*)
    )

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–∫—É–ø–∞—Ç–µ–ª—é
    await update.message.reply_text(
        f"–°–ø–∞—Å–∏–±–æ, {data['user_name']}! –í–∞—à–∞ –∑–∞—è–≤–∫–∞ –Ω–∞ *{data['product']}* (—Ä–∞–∑–º–µ—Ä {data['size']}) –ø—Ä–∏–Ω—è—Ç–∞.\n"
        "–ù–∞—à –ø—Ä–æ–¥–∞–≤–µ—Ü —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –ø–æ –Ω–æ–º–µ—Ä—É {data['user_phone']} –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.",
        parse_mode='Markdown'
    )

# –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è, –∫–æ—Ç–æ—Ä–∞—è "–∑–∞–ø—É—Å–∫–∞–µ—Ç –¥–≤–∏–≥–∞—Ç–µ–ª—å" –±–æ—Ç–∞
def main():
    """–û–±—ä—è—Å–Ω–µ–Ω–∏–µ: –≠—Ç–æ —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞. –°–Ω–∞—á–∞–ª–∞ –º—ã —Å–æ–±–∏—Ä–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ,
       –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (–∫–∞–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ –∫–∞–∫–∏–µ –∫–æ–º–∞–Ω–¥—ã —Ä–µ–∞–≥–∏—Ä—É—é—Ç),
       –∞ –ø–æ—Ç–æ–º –∑–∞–ø—É—Å–∫–∞–µ–º –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π –æ–ø—Ä–æ—Å —Å–µ—Ä–≤–µ—Ä–æ–≤ Telegram."""

    # –°–æ–∑–¥–∞–µ–º "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ" –∏ –ø–µ—Ä–µ–¥–∞–µ–º –µ–º—É —Ç–æ–∫–µ–Ω –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    application = Application.builder().token(BOT_TOKEN).build()

    # –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏:
    # –ö–æ–≥–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–∏—à–µ—Ç /start -> –≤—ã–∑—ã–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `start`
    application.add_handler(CommandHandler("start", start))
    # –ö–æ–≥–¥–∞ –ø—Ä–∏—Ö–æ–¥—è—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è -> –≤—ã–∑—ã–≤–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `web_app_data`
    application.add_handler(CallbackQueryHandler(web_app_data))

    # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞ –≤ —Ä–µ–∂–∏–º–µ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ–≥–æ –æ–ø—Ä–æ—Å–∞ (–±–æ—Ç —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç —É —Å–µ—Ä–≤–µ—Ä–æ–≤ Telegram: "–ê –º–Ω–µ —á—Ç–æ-–Ω–∏–±—É–¥—å –ø—Ä–∏—à–ª–æ?")
    print("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω –∏ —Å–ª—É—à–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è...")
    application.run_polling(allowed_updates=Update.ALL_TYPES)

# –≠—Ç–æ—Ç –±–ª–æ–∫ –≥–æ–≤–æ—Ä–∏—Ç: "–ï—Å–ª–∏ —ç—Ç–æ—Ç —Ñ–∞–π–ª –∑–∞–ø—É—Å—Ç–∏–ª–∏ –Ω–∞–ø—Ä—è–º—É—é (–∞ –Ω–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–ª–∏), —Ç–æ –≤—ã–ø–æ–ª–Ω–∏ —Ñ—É–Ω–∫—Ü–∏—é main()"
if __name__ == '__main__':

    main()
